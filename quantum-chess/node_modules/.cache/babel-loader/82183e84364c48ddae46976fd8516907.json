{"ast":null,"code":"import { PieceType, TeamType } from \"../constants\";\nimport { setEnPassant, checkEnPassant, unsetEnPassant, pawnIsBlockaded } from \"./pawnHelper\";\nexport default class Referee {\n  diagonalPathClear(px, py, dx, dy, boardState) {\n    const x_dir = Math.sign(dx);\n    const y_dir = Math.sign(dy);\n    console.log('we here');\n\n    for (let i = 1; i < Math.abs(dx) - 1; i++) {\n      const obstructingPiece = boardState.find(p => p.x === px + i * x_dir && p.y === py + i * y_dir);\n\n      if (obstructingPiece) {\n        console.log('obstructing piece at ', px + i * x_dir, py + i * y_dir);\n        console.log('px = ', px, 'py = ', py, 'i = ', i, 'xdir = ', x_dir, 'ydir = ', y_dir);\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  takePiece(x, y, team, boardState) {\n    const piece = boardState.find(p => p.x === x && p.y === y && p.team !== team);\n\n    if (piece) {\n      piece.taken = true;\n    }\n  }\n\n  isFriendlyPiece(x, y, team, boardState) {\n    const piece = boardState.find(p => p.x === x && p.y === y);\n    const occupied = piece && piece.team === team ? true : false;\n    return occupied;\n  }\n\n  endMove(x, y, team, boardState, valid) {\n    if (!this.isFriendlyPiece(x, y, team, boardState)) {\n      this.takePiece(x, y, team, boardState);\n      unsetEnPassant(boardState);\n      valid.value = true;\n    }\n  }\n\n  isValidMove(px, py, x, y, type, team, boardState, activePlayer) {\n    if (team !== activePlayer) {\n      return false;\n    }\n\n    if (px === x && py === y) {\n      return false;\n    }\n\n    const enemyTeam = team === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE;\n    var valid = {\n      value: false\n    }; //PAWN LOGIC \n    //May want to put each piece in different function\n\n    if (type === PieceType.PAWN) {\n      const startingRow = team === TeamType.WHITE ? 1 : 6;\n      const increment = team === TeamType.WHITE ? 1 : -1;\n      console.log(px, py, x, y, increment); // Moving Logic\n\n      if (py === startingRow && px === x && py === y - 2 * increment) {\n        if (!pawnIsBlockaded(x, y, boardState) && !pawnIsBlockaded(x, y - increment, boardState)) {\n          setEnPassant(px, py, boardState);\n          return true;\n        }\n      }\n\n      if (py === y - increment && px === x) {\n        if (!pawnIsBlockaded(x, y, boardState)) {\n          unsetEnPassant(boardState);\n          return true;\n        }\n      } // ATTACK LOGIC\n\n\n      if ((x === px + 1 || x === px - 1) && py === y - increment && this.isFriendlyPiece(x, y, enemyTeam, boardState)) {\n        this.endMove(x, y, team, boardState, valid);\n      }\n\n      if ((x === px + 1 || x === px - 1) && py === y - increment && this.isFriendlyPiece(x, py, enemyTeam, boardState)) {\n        if (checkEnPassant(x, py, boardState)) {\n          this.endMove(x, py, team, boardState, valid);\n        }\n      }\n    } // NIGHT LOGIC \n\n\n    if (type === PieceType.NIGHT) {\n      if ((px === x + 1 || px === x - 1) && (py === y + 2 || py === y - 2) || (py === y + 1 || py === y - 1) && (px === x + 2 || px === x - 2)) {\n        this.endMove(x, y, team, boardState, valid);\n      }\n    } // BISHOP LOGIC\n\n\n    if (type === PieceType.BISHOP) {\n      const dx = x - px;\n      const dy = x - py;\n      console.log('we here now dem booiz');\n      console.log(dx, dy);\n\n      if (Math.abs(dx) === Math.abs(dy)) {\n        if (this.diagonalPathClear(px, py, dx, dy, boardState)) {\n          this.endMove(x, y, team, boardState, valid);\n        }\n      }\n    }\n\n    return valid.value;\n  }\n\n}","map":{"version":3,"sources":["/home/jaybird/Coding Projects/Chess4/chess/src/referee/Referee.ts"],"names":["PieceType","TeamType","setEnPassant","checkEnPassant","unsetEnPassant","pawnIsBlockaded","Referee","diagonalPathClear","px","py","dx","dy","boardState","x_dir","Math","sign","y_dir","console","log","i","abs","obstructingPiece","find","p","x","y","takePiece","team","piece","taken","isFriendlyPiece","occupied","endMove","valid","value","isValidMove","type","activePlayer","enemyTeam","WHITE","BLACK","PAWN","startingRow","increment","NIGHT","BISHOP"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,QAApB,QAA2C,cAA3C;AACA,SAASC,YAAT,EAAwBC,cAAxB,EAAwCC,cAAxC,EAAwDC,eAAxD,QAA8E,cAA9E;AAEA,eAAe,MAAMC,OAAN,CAAa;AACxBC,EAAAA,iBAAiB,CAACC,EAAD,EAAcC,EAAd,EAA2BC,EAA3B,EAAwCC,EAAxC,EAAqDC,UAArD,EAAqF;AAClG,UAAMC,KAAK,GAAGC,IAAI,CAACC,IAAL,CAAUL,EAAV,CAAd;AACA,UAAMM,KAAK,GAAGF,IAAI,CAACC,IAAL,CAAUJ,EAAV,CAAd;AACAM,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,IAAI,CAACM,GAAL,CAASV,EAAT,IAAc,CAAlC,EAAqCS,CAAC,EAAtC,EAA0C;AACtC,YAAME,gBAAgB,GAAGT,UAAU,CAACU,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACC,CAAF,KAAQhB,EAAE,GAAGW,CAAC,GAACN,KAAf,IAAwBU,CAAC,CAACE,CAAF,KAAQhB,EAAE,GAAGU,CAAC,GAACH,KAA5D,CAAzB;;AACA,UAAIK,gBAAJ,EAAqB;AACjBJ,QAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCV,EAAE,GAAGW,CAAC,GAACN,KAA5C,EAAmDJ,EAAE,GAAGU,CAAC,GAACH,KAA1D;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBV,EAArB,EAAyB,OAAzB,EAAkCC,EAAlC,EAAsC,MAAtC,EAA8CU,CAA9C,EAAiD,SAAjD,EAA4DN,KAA5D,EAAmE,SAAnE,EAA8EG,KAA9E;AACA,eAAO,KAAP;AACH;AACJ;;AACD,WAAO,IAAP;AACH;;AACDU,EAAAA,SAAS,CAACF,CAAD,EAAaC,CAAb,EAAwBE,IAAxB,EAAyCf,UAAzC,EAA+D;AACpE,UAAMgB,KAAK,GAAGhB,UAAU,CAACU,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACC,CAAF,KAAQA,CAAR,IAAaD,CAAC,CAACE,CAAF,KAAQA,CAArB,IAA0BF,CAAC,CAACI,IAAF,KAAWA,IAA1D,CAAd;;AACA,QAAIC,KAAJ,EAAW;AACPA,MAAAA,KAAK,CAACC,KAAN,GAAc,IAAd;AACH;AACJ;;AACDC,EAAAA,eAAe,CAACN,CAAD,EAAaC,CAAb,EAAwBE,IAAxB,EAAyCf,UAAzC,EAAyE;AACpF,UAAMgB,KAAK,GAAGhB,UAAU,CAACU,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACC,CAAF,KAAQA,CAAR,IAAaD,CAAC,CAACE,CAAF,KAAQA,CAA1C,CAAd;AACA,UAAMM,QAAQ,GAAIH,KAAK,IAAIA,KAAK,CAACD,IAAN,KAAeA,IAAxB,GAA+B,IAA/B,GAAsC,KAAxD;AACA,WAAOI,QAAP;AACH;;AAEDC,EAAAA,OAAO,CAACR,CAAD,EAAaC,CAAb,EAAwBE,IAAxB,EAAyCf,UAAzC,EAAgEqB,KAAhE,EAA4E;AAC/E,QAAI,CAAC,KAAKH,eAAL,CAAqBN,CAArB,EAAwBC,CAAxB,EAA2BE,IAA3B,EAAiCf,UAAjC,CAAL,EAAkD;AAC9C,WAAKc,SAAL,CAAeF,CAAf,EAAkBC,CAAlB,EAAqBE,IAArB,EAA2Bf,UAA3B;AACAR,MAAAA,cAAc,CAACQ,UAAD,CAAd;AACAqB,MAAAA,KAAK,CAACC,KAAN,GAAc,IAAd;AACH;AACJ;;AACDC,EAAAA,WAAW,CAAC3B,EAAD,EAAcC,EAAd,EAA2Be,CAA3B,EAAuCC,CAAvC,EAAmDW,IAAnD,EACCT,IADD,EACkBf,UADlB,EACyCyB,YADzC,EACiE;AACxE,QAAIV,IAAI,KAAKU,YAAb,EAA0B;AACtB,aAAO,KAAP;AACH;;AACD,QAAI7B,EAAE,KAAKgB,CAAP,IAAYf,EAAE,KAAKgB,CAAvB,EAAyB;AACrB,aAAO,KAAP;AACH;;AACD,UAAMa,SAAS,GAAGX,IAAI,KAAK1B,QAAQ,CAACsC,KAAlB,GAA0BtC,QAAQ,CAACuC,KAAnC,GAA2CvC,QAAQ,CAACsC,KAAtE;AACA,QAAIN,KAAK,GAAG;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAAZ,CARwE,CASxE;AACA;;AACA,QAAIE,IAAI,KAAKpC,SAAS,CAACyC,IAAvB,EAA4B;AACxB,YAAMC,WAAW,GAAGf,IAAI,KAAK1B,QAAQ,CAACsC,KAAlB,GAA0B,CAA1B,GAA8B,CAAlD;AACA,YAAMI,SAAS,GAAGhB,IAAI,KAAK1B,QAAQ,CAACsC,KAAlB,GAA0B,CAA1B,GAA8B,CAAE,CAAlD;AACAtB,MAAAA,OAAO,CAACC,GAAR,CAAYV,EAAZ,EAAgBC,EAAhB,EAAoBe,CAApB,EAAuBC,CAAvB,EAA0BkB,SAA1B,EAHwB,CAIxB;;AACA,UAAKlC,EAAE,KAAKiC,WAAP,IAAsBlC,EAAE,KAAKgB,CAA9B,IAAqCf,EAAE,KAAKgB,CAAC,GAAG,IAAIkB,SAAxD,EAAmE;AAC/D,YAAI,CAACtC,eAAe,CAACmB,CAAD,EAAIC,CAAJ,EAAOb,UAAP,CAAhB,IAAsC,CAACP,eAAe,CAACmB,CAAD,EAAIC,CAAC,GAAGkB,SAAR,EAAmB/B,UAAnB,CAA1D,EAAyF;AACrFV,UAAAA,YAAY,CAACM,EAAD,EAAKC,EAAL,EAASG,UAAT,CAAZ;AACA,iBAAO,IAAP;AACH;AACJ;;AACD,UAAIH,EAAE,KAAKgB,CAAC,GAAGkB,SAAX,IAAwBnC,EAAE,KAAKgB,CAAnC,EAAqC;AACjC,YAAI,CAACnB,eAAe,CAACmB,CAAD,EAAIC,CAAJ,EAAOb,UAAP,CAApB,EAAuC;AACnCR,UAAAA,cAAc,CAACQ,UAAD,CAAd;AACA,iBAAO,IAAP;AACH;AACJ,OAhBuB,CAiBxB;;;AACA,UAAI,CAACY,CAAC,KAAKhB,EAAE,GAAG,CAAX,IAAgBgB,CAAC,KAAKhB,EAAE,GAAE,CAA3B,KAAkCC,EAAE,KAAKgB,CAAC,GAAGkB,SAA7C,IAA2D,KAAKb,eAAL,CAAqBN,CAArB,EAAwBC,CAAxB,EAA2Ba,SAA3B,EAAsC1B,UAAtC,CAA/D,EAAkH;AAC9G,aAAKoB,OAAL,CAAaR,CAAb,EAAgBC,CAAhB,EAAmBE,IAAnB,EAAyBf,UAAzB,EAAqCqB,KAArC;AACH;;AACD,UAAI,CAACT,CAAC,KAAKhB,EAAE,GAAG,CAAX,IAAgBgB,CAAC,KAAKhB,EAAE,GAAE,CAA3B,KAAkCC,EAAE,KAAKgB,CAAC,GAAGkB,SAA7C,IAA2D,KAAKb,eAAL,CAAqBN,CAArB,EAAwBf,EAAxB,EAA4B6B,SAA5B,EAAuC1B,UAAvC,CAA/D,EAAmH;AAC/G,YAAIT,cAAc,CAACqB,CAAD,EAAIf,EAAJ,EAAQG,UAAR,CAAlB,EAAsC;AAClC,eAAKoB,OAAL,CAAaR,CAAb,EAAgBf,EAAhB,EAAoBkB,IAApB,EAA0Bf,UAA1B,EAAsCqB,KAAtC;AACH;AACJ;AACJ,KArCuE,CAsCxE;;;AACA,QAAIG,IAAI,KAAKpC,SAAS,CAAC4C,KAAvB,EAA6B;AACzB,UAAK,CAACpC,EAAE,KAAKgB,CAAC,GAAG,CAAX,IAAgBhB,EAAE,KAAKgB,CAAC,GAAG,CAA5B,MAAoCf,EAAE,KAAKgB,CAAC,GAAG,CAAX,IAAgBhB,EAAE,KAAKgB,CAAC,GAAG,CAA/D,CAAD,IACC,CAAChB,EAAE,KAAKgB,CAAC,GAAG,CAAX,IAAgBhB,EAAE,KAAKgB,CAAC,GAAG,CAA5B,MAAoCjB,EAAE,KAAKgB,CAAC,GAAG,CAAX,IAAgBhB,EAAE,KAAKgB,CAAC,GAAG,CAA/D,CADL,EACwE;AAChE,aAAKQ,OAAL,CAAaR,CAAb,EAAgBC,CAAhB,EAAmBE,IAAnB,EAAyBf,UAAzB,EAAqCqB,KAArC;AACP;AACJ,KA5CuE,CA6CxE;;;AACA,QAAIG,IAAI,KAAKpC,SAAS,CAAC6C,MAAvB,EAA8B;AAC1B,YAAMnC,EAAE,GAAGc,CAAC,GAAGhB,EAAf;AACA,YAAMG,EAAE,GAAGa,CAAC,GAAGf,EAAf;AACAQ,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYR,EAAZ,EAAgBC,EAAhB;;AACA,UAAIG,IAAI,CAACM,GAAL,CAASV,EAAT,MAAiBI,IAAI,CAACM,GAAL,CAAST,EAAT,CAArB,EAAkC;AAC9B,YAAG,KAAKJ,iBAAL,CAAuBC,EAAvB,EAA2BC,EAA3B,EAA+BC,EAA/B,EAAmCC,EAAnC,EAAuCC,UAAvC,CAAH,EAAsD;AAClD,eAAKoB,OAAL,CAAaR,CAAb,EAAgBC,CAAhB,EAAmBE,IAAnB,EAAyBf,UAAzB,EAAqCqB,KAArC;AACH;AACJ;AACJ;;AAED,WAAOA,KAAK,CAACC,KAAb;AACH;;AA9FuB","sourcesContent":["import { PieceType, TeamType, Piece } from \"../constants\"\nimport { setEnPassant , checkEnPassant, unsetEnPassant, pawnIsBlockaded} from \"./pawnHelper\"\n\nexport default class Referee{\n    diagonalPathClear(px : number, py : number, dx : number, dy : number, boardState : Piece[]) : boolean {\n        const x_dir = Math.sign(dx)\n        const y_dir = Math.sign(dy)\n        console.log('we here')\n        for (let i = 1; i < Math.abs(dx) -1; i ++){\n            const obstructingPiece = boardState.find(p => p.x === px + i*x_dir && p.y === py + i*y_dir) \n            if (obstructingPiece){\n                console.log('obstructing piece at ', px + i*x_dir, py + i*y_dir)\n                console.log('px = ', px, 'py = ', py, 'i = ', i, 'xdir = ', x_dir, 'ydir = ', y_dir)\n                return false\n            }\n        }\n        return true\n    }\n    takePiece(x : number, y: number, team : TeamType, boardState : Piece []){\n        const piece = boardState.find(p => p.x === x && p.y === y && p.team !== team)  \n        if (piece) {\n            piece.taken = true\n        }\n    }\n    isFriendlyPiece(x : number, y: number, team : TeamType, boardState : Piece []): boolean {\n        const piece = boardState.find(p => p.x === x && p.y === y)\n        const occupied =  piece && piece.team === team ? true : false\n        return occupied\n    }\n\n    endMove(x : number, y: number, team : TeamType, boardState : Piece [], valid : any){\n        if (!this.isFriendlyPiece(x, y, team, boardState)){\n            this.takePiece(x, y, team, boardState)\n            unsetEnPassant(boardState)\n            valid.value = true          \n        }\n    }\n    isValidMove(px : number, py : number, x : number, y : number, type : PieceType, \n                team : TeamType, boardState : Piece [], activePlayer : TeamType){\n        if (team !== activePlayer){\n            return false\n        }\n        if (px === x && py === y){\n            return false\n        }\n        const enemyTeam = team === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE\n        var valid = { value: false }\n        //PAWN LOGIC \n        //May want to put each piece in different function\n        if (type === PieceType.PAWN){\n            const startingRow = team === TeamType.WHITE ? 1 : 6\n            const increment = team === TeamType.WHITE ? 1 : - 1\n            console.log(px, py, x, y, increment)\n            // Moving Logic\n            if ((py === startingRow && px === x) && (py === y - 2 * increment)){\n                if (!pawnIsBlockaded(x, y, boardState) && !pawnIsBlockaded(x, y - increment, boardState)){\n                    setEnPassant(px, py, boardState)\n                    return true\n                }\n            } \n            if (py === y - increment && px === x){\n                if (!pawnIsBlockaded(x, y, boardState)){\n                    unsetEnPassant(boardState)\n                    return true;\n                }\n            } \n            // ATTACK LOGIC\n            if ((x === px + 1 || x === px -1) && (py === y - increment) && this.isFriendlyPiece(x, y, enemyTeam, boardState)) {\n                this.endMove(x, y, team, boardState, valid)\n            }\n            if ((x === px + 1 || x === px -1) && (py === y - increment) && this.isFriendlyPiece(x, py, enemyTeam, boardState)) {\n                if (checkEnPassant(x, py, boardState)){\n                    this.endMove(x, py, team, boardState, valid)\n                }\n            }\n        }\n        // NIGHT LOGIC \n        if (type === PieceType.NIGHT){\n            if (((px === x + 1 || px === x - 1) &&  (py === y + 2 || py === y - 2)) ||\n                ((py === y + 1 || py === y - 1) &&  (px === x + 2 || px === x - 2))){\n                    this.endMove(x, y, team, boardState, valid)\n            }\n        }\n        // BISHOP LOGIC\n        if (type === PieceType.BISHOP){\n            const dx = x - px\n            const dy = x - py\n            console.log('we here now dem booiz')\n            console.log(dx, dy)\n            if (Math.abs(dx) === Math.abs(dy)){\n                if(this.diagonalPathClear(px, py, dx, dy, boardState)){\n                    this.endMove(x, y, team, boardState, valid)\n                }\n            }\n        }\n\n        return valid.value\n    }\n}"]},"metadata":{},"sourceType":"module"}