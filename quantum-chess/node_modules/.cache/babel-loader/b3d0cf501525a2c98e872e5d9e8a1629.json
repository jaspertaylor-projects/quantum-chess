{"ast":null,"code":"var _jsxFileName = \"/home/jaybird/Coding Projects/Chess4/chess/src/components/chessboard/chessboard.tsx\",\n    _s = $RefreshSig$();\n\n/*\nThis is the hess board react function.  It is the only element in our App.tsx and\nit is responsible for keeping the Piece [] in sync with the displayed tiles of the \nchess board.  The boards state updates via React hooks which are all declared at \nthe top of the function. \n*/\nimport React, { useRef, useState } from 'react';\nimport Tile from '../Tile/Tile';\nimport './chessboard.css';\nimport Referee from '../../referee/Referee';\nimport { VERTICAL_AXIS, HORIZONTAL_AXIS, GRID_SIZE, TeamType, initializeBoardState } from '../../constants';\nimport Checker from '../../referee/boardChecks';\nimport { PROMOTED_PIECE, IMAGE, CLICKED } from '../PopUp/PopUp';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chessboard() {\n  _s();\n\n  const [activePiece, setActivePiece] = useState(null);\n  const [gridX, setGridX] = useState(0);\n  const [gridY, setGridY] = useState(0);\n  const [pieces, setPieces] = useState(initializeBoardState());\n  const [activePlayer, setActivePlayer] = useState(TeamType.WHITE);\n  const [winner, setWinner] = useState('');\n  const [[checkMate, message], setCheckMate] = useState([false, '']);\n  const chessboardRef = useRef(null);\n  const referee = new Referee();\n  let board = []; // Returns the board state to the original board state\n\n  function newGame() {\n    setPieces(initializeBoardState());\n    setActivePlayer(TeamType.WHITE);\n    setCheckMate([false, ' ']);\n  } // Used To make a copy of the piece array.  This is useful to pass while \n  // cheking for check mate so the actual board state does not get changed \n  // in the process\n\n\n  function deepCopy() {\n    const oldBoardState = [];\n    pieces.forEach(p => oldBoardState.push({\n      image: p.image,\n      x: p.x,\n      y: p.y,\n      team: p.team,\n      type: p.type,\n      enPassantable: p.enPassantable,\n      canCastle: p.canCastle,\n      promoted: p.promoted\n    }));\n    return oldBoardState;\n  } // Switches the game state from WHITE to BLACK and vice versa\n\n\n  function switchPlayer() {\n    const nextPlayer = activePlayer === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE;\n    setActivePlayer(nextPlayer);\n  } // Returns the active piece to its original location.\n\n\n  function revert() {\n    if (activePiece) {\n      activePiece.style.position = 'relative';\n      activePiece.style.removeProperty('left');\n      activePiece.style.removeProperty('top');\n      setPieces(pieces);\n    }\n  }\n\n  function promotePieces() {\n    const promotedPiece = pieces.find(p => p.promoted === true);\n\n    if (promotedPiece) {\n      const id = pieces.indexOf(promotedPiece);\n      pieces[id] = {\n        image: IMAGE,\n        x: promotedPiece.x,\n        y: promotedPiece.y,\n        taken: false,\n        team: promotedPiece.team,\n        type: PROMOTED_PIECE,\n        enPassantable: false,\n        promoted: false\n      };\n    }\n  }\n\n  function grabPiece(e) {\n    const chessboard = chessboardRef.current;\n    const element = e.target;\n\n    if (element.classList.contains('chess-piece') && chessboard) {\n      setGridX(Math.floor((e.clientX - chessboard.offsetLeft) / GRID_SIZE));\n      setGridY(Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE) / GRID_SIZE)));\n      const x = e.clientX - GRID_SIZE / 2;\n      const y = e.clientY - GRID_SIZE / 2;\n      element.style.position = 'absolute';\n      element.style.left = `${x}px`;\n      element.style.top = `${y}px`;\n      setActivePiece(element);\n    }\n  }\n\n  function movePiece(e) {\n    const chessboard = chessboardRef.current;\n\n    if (activePiece && chessboard) {\n      const x = e.clientX - GRID_SIZE / 2;\n      const y = e.clientY - GRID_SIZE / 2;\n      activePiece.style.position = 'absolute';\n      activePiece.style.left = `${x}px`;\n      activePiece.style.top = `${y}px`;\n    }\n  }\n\n  function dropPiece(e) {\n    const chessboard = chessboardRef.current;\n\n    if (activePiece && chessboard) {\n      if (CLICKED) {\n        promotePieces();\n      }\n\n      const x = Math.floor((e.clientX - chessboard.offsetLeft) / GRID_SIZE);\n      const y = Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE) / GRID_SIZE));\n      const currentPiece = pieces.find(p => p.x === gridX && p.y === gridY);\n\n      if (currentPiece) {\n        const oldBoardState = deepCopy();\n        const validMove = referee.isValidMove(gridX, gridY, x, y, currentPiece.type, currentPiece.team, pieces, activePlayer);\n\n        if (validMove) {\n          switchPlayer();\n          setPieces(pieces);\n        } else {\n          setPieces(oldBoardState);\n          revert();\n        }\n\n        const boardState = deepCopy();\n        const boardState2 = deepCopy();\n        const checker = new Checker(boardState2);\n        const oppponent = activePlayer === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE;\n        const checkMate = checker.isCheckMate(activePlayer, boardState);\n\n        if (checkMate) {\n          if (checker.isMyKingInCheck(oppponent, boardState, 0)) {\n            const winner = activePlayer === TeamType.WHITE ? 'White Wins' : 'Black Wins';\n            setWinner(winner);\n            setCheckMate([true, 'Check Mate']);\n          } else {\n            setWinner('Players Draw');\n            setCheckMate([true, 'Stale Mate']);\n          }\n        }\n      }\n    }\n\n    setActivePiece(null);\n  }\n\n  for (let j = VERTICAL_AXIS.length - 1; j >= 0; j--) {\n    for (let i = 0; i < HORIZONTAL_AXIS.length; i++) {\n      const number = i + j;\n      const piece = pieces.find(p => p.x === i && p.y === j);\n      let image = piece ? piece.image : undefined;\n      const promotedPiece = pieces.find(p => p.promoted === true);\n      const team = promotedPiece && promotedPiece.y === 7 ? TeamType.WHITE : TeamType.BLACK;\n\n      if (promotedPiece && promotedPiece.x === i && promotedPiece.y === j) {\n        board.push( /*#__PURE__*/_jsxDEV(Tile, {\n          image: image,\n          number: number,\n          team: team,\n          isPromotion: true\n        }, `${i}, ${j}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 28\n        }, this));\n      } else {\n        board.push( /*#__PURE__*/_jsxDEV(Tile, {\n          image: image,\n          number: number,\n          team: team,\n          isPromotion: false\n        }, `${i}, ${j}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 28\n        }, this));\n      }\n    }\n  }\n\n  if (!checkMate) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: chessboardRef,\n      onMouseUp: e => dropPiece(e),\n      onMouseMove: e => movePiece(e),\n      onMouseDown: e => grabPiece(e),\n      className: \"chessboard\",\n      children: board\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 12\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        ref: chessboardRef,\n        className: \"chessboard grayed-out\",\n        children: board\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"check\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mate\",\n          children: [\" \", message, \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 41\n          }, this), \" \", winner, \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"newgame\",\n        onClick: newGame,\n        children: \" Play Again \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 12\n    }, this);\n  }\n}\n\n_s(Chessboard, \"1BTW72ZQ+ODjnAybwXOI7vYabGQ=\");\n\n_c = Chessboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chessboard\");","map":{"version":3,"sources":["/home/jaybird/Coding Projects/Chess4/chess/src/components/chessboard/chessboard.tsx"],"names":["React","useRef","useState","Tile","Referee","VERTICAL_AXIS","HORIZONTAL_AXIS","GRID_SIZE","TeamType","initializeBoardState","Checker","PROMOTED_PIECE","IMAGE","CLICKED","Chessboard","activePiece","setActivePiece","gridX","setGridX","gridY","setGridY","pieces","setPieces","activePlayer","setActivePlayer","WHITE","winner","setWinner","checkMate","message","setCheckMate","chessboardRef","referee","board","newGame","deepCopy","oldBoardState","forEach","p","push","image","x","y","team","type","enPassantable","canCastle","promoted","switchPlayer","nextPlayer","BLACK","revert","style","position","removeProperty","promotePieces","promotedPiece","find","id","indexOf","taken","grabPiece","e","chessboard","current","element","target","classList","contains","Math","floor","clientX","offsetLeft","abs","ceil","clientY","offsetTop","left","top","movePiece","dropPiece","currentPiece","validMove","isValidMove","boardState","boardState2","checker","oppponent","isCheckMate","isMyKingInCheck","j","length","i","number","piece","undefined"],"mappings":"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","sourcesContent":["\n/*\nThis is the hess board react function.  It is the only element in our App.tsx and\nit is responsible for keeping the Piece [] in sync with the displayed tiles of the \nchess board.  The boards state updates via React hooks which are all declared at \nthe top of the function. \n*/\n\nimport React, {useRef, useState, } from 'react';\nimport Tile from '../Tile/Tile';\nimport './chessboard.css';\nimport Referee from '../../referee/Referee'\nimport {VERTICAL_AXIS, HORIZONTAL_AXIS, GRID_SIZE, Piece, TeamType, initializeBoardState} from '../../constants'\nimport Checker from '../../referee/boardChecks'\nimport { PROMOTED_PIECE , IMAGE, CLICKED} from '../PopUp/PopUp';\n\nexport default function Chessboard(){\n    const [activePiece, setActivePiece] = useState<HTMLElement | null>(null) \n    const [gridX, setGridX] = useState(0);\n    const [gridY, setGridY] = useState(0);\n    const [pieces, setPieces]  = useState<Piece[]>(initializeBoardState());\n    const [activePlayer, setActivePlayer] = useState<TeamType>(TeamType.WHITE);\n    const [winner, setWinner]  = useState('');\n    const [[checkMate, message], setCheckMate] = useState([false, '']);\n    const chessboardRef = useRef<HTMLDivElement>(null);\n    const referee = new Referee();\n    let board = [];\n    \n    // Returns the board state to the original board state\n    function newGame(){\n        setPieces(initializeBoardState())\n        setActivePlayer(TeamType.WHITE)\n        setCheckMate([false, ' '])\n    }\n\n    // Used To make a copy of the piece array.  This is useful to pass while \n    // cheking for check mate so the actual board state does not get changed \n    // in the process\n    function deepCopy() {\n        const oldBoardState : Piece[] = [];\n        pieces.forEach(p => oldBoardState.push({image : p.image, x : p.x,  y : p.y,\n                                                team : p.team, type : p.type, \n                                                enPassantable : p.enPassantable,\n                                                canCastle: p.canCastle,\n                                                promoted: p.promoted}))\n        return oldBoardState\n    }\n\n    // Switches the game state from WHITE to BLACK and vice versa\n    function switchPlayer(){\n        const nextPlayer = activePlayer === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE\n        setActivePlayer(nextPlayer) \n    }\n\n    // Returns the active piece to its original location.\n    function revert(){\n        if (activePiece){\n            activePiece.style.position = 'relative';\n            activePiece.style.removeProperty('left');\n            activePiece.style.removeProperty('top');\n            setPieces(pieces)\n        }\n    }\n\n    function promotePieces(){\n        const promotedPiece = pieces.find(p => p.promoted === true)\n        if (promotedPiece){\n            const id = pieces.indexOf(promotedPiece)\n            pieces[id] = {image : IMAGE, x : promotedPiece.x,  y: promotedPiece.y, taken : false,\n                        team : promotedPiece.team, type : PROMOTED_PIECE, enPassantable : false,\n                        promoted : false}\n        }\n    }\n\n    function grabPiece(e: React.MouseEvent){\n        const chessboard = chessboardRef.current\n        const element = e.target as HTMLElement\n        if (element.classList.contains('chess-piece') && chessboard){\n            setGridX(Math.floor((e.clientX - chessboard.offsetLeft)/GRID_SIZE));\n            setGridY(Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE)/GRID_SIZE)));\n            const x = e.clientX - GRID_SIZE/2;\n            const y = e.clientY - GRID_SIZE/2;\n            element.style.position = 'absolute'; \n            element.style.left = `${x}px`;\n            element.style.top = `${y}px`;\n            setActivePiece(element)    \n        }\n    \n    }\n    \n    function movePiece(e: React.MouseEvent){\n        const chessboard = chessboardRef.current\n        if (activePiece && chessboard){\n            const x = e.clientX - GRID_SIZE/2;\n            const y = e.clientY - GRID_SIZE/2;\n            activePiece.style.position = 'absolute'; \n            activePiece.style.left = `${x}px`;\n            activePiece.style.top = `${y}px`;\n        }\n    }\n    \n    function dropPiece(e: React.MouseEvent){\n        const chessboard = chessboardRef.current;\n        if (activePiece && chessboard){\n            if (CLICKED){\n                promotePieces()\n            }  \n            const x = Math.floor((e.clientX - chessboard.offsetLeft)/GRID_SIZE);\n            const y = Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE)/GRID_SIZE))\n            const currentPiece = pieces.find(p => p.x === gridX && p.y === gridY)\n            if (currentPiece){\n                const oldBoardState = deepCopy()\n                const validMove = referee.isValidMove(gridX, gridY, x, y, currentPiece.type, currentPiece.team, pieces, activePlayer);                \n                \n                if (validMove){  \n                    switchPlayer()\n                    setPieces(pieces)\n                } else {\n                    setPieces(oldBoardState)\n                    revert()\n                }\n            const boardState = deepCopy()\n            const boardState2 = deepCopy()\n            const checker = new Checker(boardState2);\n            const oppponent = activePlayer === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE\n            const checkMate = checker.isCheckMate(activePlayer, boardState)\n            if (checkMate){\n                if(checker.isMyKingInCheck(oppponent, boardState, 0)){\n                    const winner = activePlayer === TeamType.WHITE ? 'White Wins' : 'Black Wins'\n                    setWinner(winner)\n                    setCheckMate([true, 'Check Mate'])\n                } else {\n                    setWinner('Players Draw')\n                    setCheckMate([true, 'Stale Mate'])\n                }\n\n            }\n            }\n        }\n        setActivePiece(null);\n    }\n\n    for (let j = VERTICAL_AXIS.length - 1; j >= 0; j-- ){\n        for (let i = 0; i < HORIZONTAL_AXIS.length; i++ ) {\n            const number = i + j;\n            const piece = pieces.find(p => p.x === i && p.y === j) \n            let image = piece ? piece.image : undefined\n            const promotedPiece = pieces.find(p => p.promoted === true)\n            const team = promotedPiece && promotedPiece.y === 7 ? TeamType.WHITE : TeamType.BLACK \n            if (promotedPiece && promotedPiece.x === i && promotedPiece.y === j){\n                board.push(<Tile key = {`${i}, ${j}`} image = {image} number = {number} team = {team} isPromotion = {true}/>);\n            } else {\n                board.push(<Tile key = {`${i}, ${j}`} image = {image} number = {number} team = {team} isPromotion = {false}/>);\n            }\n        }\n    }\n\n    if (!checkMate){\n    return <div \n    ref = {chessboardRef} \n    onMouseUp = {e => dropPiece(e)} \n    onMouseMove = {e => movePiece(e)} \n    onMouseDown = {e => grabPiece(e)} \n    className = 'chessboard'>{board}\n    </div>;\n    } else {\n    return <div><div \n    ref = {chessboardRef} \n    className = 'chessboard grayed-out' >{board}\n    </div><div className = 'check'>\n    <div className = 'mate' > {message} <br></br> {winner} </div>\n    </div>\n    <button className = 'newgame' onClick = {newGame}> Play Again </button>\n    </div>;\n    }\n}"]},"metadata":{},"sourceType":"module"}