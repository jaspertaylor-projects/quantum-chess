{"ast":null,"code":"import { PieceType, TeamType, AXIS, initialBoardState } from \"../constants\";\nimport { isPawnNormalMove, isEnPassant, isPawnStartingMove, isFriendlyPiece, unsetEnPassant, setEnPassant } from \"./pawnLogic\";\nimport { isLegalBishopMove, isLegalRookMove, isLegalQueenMove, isLegalKingMove, isLegalNightMove, isCastleMove } from \"./pieceLogic\";\nimport Checker from './boardChecks';\nimport { CLICKED } from '../components/PopUp/PopUp';\nimport { executeMove } from \"./executeMove\";\nexport default class Referee {\n  deepCopy(boardState) {\n    const oldBoardState = [];\n    boardState.forEach(p => oldBoardState.push({\n      image: p.image,\n      x: p.x,\n      y: p.y,\n      team: p.team,\n      type: p.type,\n      enPassantable: p.enPassantable,\n      canCastle: p.canCastle,\n      promoted: p.promoted\n    }));\n    return oldBoardState;\n  }\n\n  promote(px, py, x, y, boardState) {\n    const piece = boardState.find(p => p.x === px && p.y === py);\n\n    if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.WHITE && y === 7) {\n      piece.promoted = true;\n    } else if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.BLACK && y === 0) {\n      piece.promoted = true;\n    } else if (piece) {\n      piece.promoted = false;\n    }\n  }\n\n  noCastle(px, py, boardState) {\n    const piece = boardState.find(p => p.x === px && p.y === py);\n\n    if (piece) {\n      piece.canCastle = false;\n    }\n  }\n\n  takePiece(x, y, team, boardState) {\n    const piece = boardState.find(p => p.x === x && p.y === y && p.team !== team);\n\n    if (piece) {\n      piece.taken = true;\n    }\n  }\n\n  endMove(px, py, x, y, team, boardState, oldBoardState, valid, enPassant) {\n    if (!isFriendlyPiece(x, y, team, boardState)) {\n      this.promote(px, py, x, y, boardState);\n      this.noCastle(px, py, boardState);\n      this.takePiece(x, y, team, boardState);\n\n      if (enPassant) {\n        setEnPassant(px, py, boardState);\n      } else {\n        unsetEnPassant(boardState);\n      }\n\n      executeMove(px, py, x, y, boardState);\n      const checker = new Checker();\n      const inCheck = checker.isMyKingInCheck(team, boardState, 0);\n\n      if (inCheck) {\n        console.log('Cant make this move');\n        boardState = initialBoardState;\n        valid.value = false;\n      } else {\n        valid.value = true;\n      }\n    }\n  }\n\n  isValidMove(px, py, x, y, type, team, boardState, activePlayer) {\n    const oldBoardState = this.deepCopy(boardState);\n    console.log(oldBoardState);\n\n    if (!CLICKED) {\n      return false;\n    } // Only the active player can move\n\n\n    if (team !== activePlayer) {\n      return false;\n    } // A non-move is not a move\n\n\n    if (px === x && py === y) {\n      return false;\n    } // A move off the board is not a move\n\n\n    if (!(AXIS.includes(px) && AXIS.includes(py) && AXIS.includes(x) && AXIS.includes(y))) {\n      return false;\n    }\n\n    var valid = {\n      value: false\n    };\n    const dx = x - px;\n    const dy = y - py;\n\n    switch (type) {\n      case PieceType.PAWN:\n        {\n          if (isPawnStartingMove(px, py, x, y, team, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, true);\n          }\n\n          if (isPawnNormalMove(px, py, x, y, team, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false);\n          }\n\n          if (isEnPassant(px, py, x, y, team, boardState)) {\n            this.endMove(-1, -1, x, py, team, boardState, oldBoardState, valid, false);\n          }\n\n          break;\n        }\n\n      case PieceType.NIGHT:\n        {\n          if (isLegalNightMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false);\n          }\n\n          break;\n        }\n\n      case PieceType.BISHOP:\n        {\n          if (isLegalBishopMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false);\n          }\n\n          break;\n        }\n\n      case PieceType.ROOK:\n        {\n          if (isLegalRookMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false);\n          }\n\n          break;\n        }\n\n      case PieceType.QUEEN:\n        {\n          if (isLegalQueenMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false);\n          }\n\n          break;\n        }\n\n      case PieceType.KING:\n        {\n          if (isLegalKingMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false);\n          }\n\n          if (isCastleMove(px, py, dx, dy, activePlayer, boardState)) {\n            if (activePlayer === TeamType.WHITE) {\n              if (dx === -2) {\n                const piece = boardState.find(p => p.x === 0 && p.y === 0);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n\n              if (dx === 2) {\n                const piece = boardState.find(p => p.x === 7 && p.y === 0);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n            }\n\n            if (activePlayer === TeamType.BLACK) {\n              if (dx === -2) {\n                const piece = boardState.find(p => p.x === 0 && p.y === 7);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n\n              if (dx === 2) {\n                const piece = boardState.find(p => p.x === 7 && p.y === 7);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n            }\n\n            this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false);\n          }\n\n          break;\n        }\n    }\n\n    console.log(valid.value);\n    return valid.value;\n  }\n\n}","map":{"version":3,"sources":["/home/jaybird/Coding Projects/Chess4/chess/src/referee/Referee.ts"],"names":["PieceType","TeamType","AXIS","initialBoardState","isPawnNormalMove","isEnPassant","isPawnStartingMove","isFriendlyPiece","unsetEnPassant","setEnPassant","isLegalBishopMove","isLegalRookMove","isLegalQueenMove","isLegalKingMove","isLegalNightMove","isCastleMove","Checker","CLICKED","executeMove","Referee","deepCopy","boardState","oldBoardState","forEach","p","push","image","x","y","team","type","enPassantable","canCastle","promoted","promote","px","py","piece","find","PAWN","WHITE","BLACK","noCastle","takePiece","taken","endMove","valid","enPassant","checker","inCheck","isMyKingInCheck","console","log","value","isValidMove","activePlayer","includes","dx","dy","NIGHT","BISHOP","ROOK","QUEEN","KING","teleported"],"mappings":"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","sourcesContent":["\nimport { PieceType, TeamType, Piece, AXIS, initialBoardState, } from \"../constants\"\nimport { isPawnNormalMove, isEnPassant, isPawnStartingMove, isFriendlyPiece, unsetEnPassant, setEnPassant } from \"./pawnLogic\"\nimport { isLegalBishopMove, isLegalRookMove, isLegalQueenMove, isLegalKingMove, isLegalNightMove, isCastleMove} from \"./pieceLogic\"\nimport Checker from './boardChecks'\nimport {CLICKED} from '../components/PopUp/PopUp'\nimport { executeMove } from \"./executeMove\"\n\nexport default class Referee{\n    deepCopy(boardState : Piece []) : Piece [] {\n        const oldBoardState : Piece[] = [];\n        boardState.forEach(p => oldBoardState.push({image : p.image, x : p.x,  y : p.y,\n                                                team : p.team, type : p.type, \n                                                enPassantable : p.enPassantable,\n                                                canCastle: p.canCastle,\n                                                promoted: p.promoted}))\n        return oldBoardState\n    }\n    \n    promote(px: number, py: number, x : number, y: number, boardState : Piece []){\n    const piece = boardState.find(p => p.x === px && p.y === py)\n        if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.WHITE && y === 7){\n            piece.promoted = true\n        }   \n        else if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.BLACK && y === 0){\n            piece.promoted = true\n        } else if (piece){\n            piece.promoted = false\n        }\n    }    \n    noCastle(px: number, py: number, boardState : Piece []){\n        const piece = boardState.find(p => p.x === px && p.y === py)\n        if (piece){\n            piece.canCastle = false\n        }\n    }\n    takePiece(x : number, y: number, team : TeamType, boardState : Piece []){\n        const piece = boardState.find(p => p.x === x && p.y === y && p.team !== team)  \n                if (piece) {\n            piece.taken = true\n        }\n    }\n\n    endMove(px : number, py : number, x : number, y: number, team : TeamType, \n            boardState : Piece [], oldBoardState : Piece [], valid : any, enPassant: boolean){\n        if (!isFriendlyPiece(x, y, team, boardState)){\n            this.promote(px, py, x, y, boardState)\n            this.noCastle(px, py, boardState)\n            this.takePiece(x, y, team, boardState)\n            if (enPassant){\n                setEnPassant(px, py, boardState)\n            } else{\n                unsetEnPassant(boardState)\n            }\n            executeMove(px, py, x, y, boardState)\n            const checker = new Checker();\n            const inCheck = checker.isMyKingInCheck(team, boardState, 0)\n            if (inCheck){\n                console.log('Cant make this move')\n                boardState = initialBoardState\n                valid.value = false\n            }  else {\n                valid.value = true\n            }      \n        }\n    }\n    isValidMove(px : number, py : number, x : number, y : number, type : PieceType, \n                team : TeamType, boardState : Piece [],  activePlayer : TeamType) : boolean{\n        const oldBoardState = this.deepCopy(boardState)\n        console.log(oldBoardState)\n        if (!CLICKED){\n            return false\n        }  \n        // Only the active player can move\n        if (team !== activePlayer){\n            return false\n        }\n        // A non-move is not a move\n        if (px === x && py === y){\n            return false\n        }\n        // A move off the board is not a move\n        if (!(AXIS.includes(px) &&  AXIS.includes(py) &&  AXIS.includes(x) && AXIS.includes(y))){\n            return false\n        }\n        var valid = { value: false }\n        const dx = x - px\n        const dy = y - py\n\n        switch(type){\n            case PieceType.PAWN : {\n                if (isPawnStartingMove(px, py, x, y, team, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, true)\n                }\n                if (isPawnNormalMove(px, py, x, y, team, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false)\n                }\n                if (isEnPassant(px, py, x, y, team, boardState)){\n                    this.endMove(-1, -1, x, py, team, boardState, oldBoardState, valid, false)\n                }\n                break;\n            }\n            case PieceType.NIGHT : {\n                if (isLegalNightMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false)\n                }\n                break;\n            }\n            case PieceType.BISHOP : {\n                if (isLegalBishopMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false)\n                }\n                break;\n            }\n            case PieceType.ROOK : {\n                if (isLegalRookMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false)\n                }\n                break;\n            }\n            case PieceType.QUEEN : {\n                if (isLegalQueenMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false)\n                }\n                break;\n            }\n            case PieceType.KING : {\n                if (isLegalKingMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false)\n                }\n                if (isCastleMove(px, py, dx, dy, activePlayer, boardState)){\n                    if (activePlayer === TeamType.WHITE){\n                        if (dx === -2){ \n                            const piece = boardState.find(p => p.x === 0 && p.y === 0)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                        if (dx === 2){ \n                            const piece = boardState.find(p => p.x === 7 && p.y === 0)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                    }\n                    if (activePlayer === TeamType.BLACK){\n                        if (dx === -2){ \n                            const piece = boardState.find(p => p.x === 0 && p.y === 7)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                        if (dx === 2){ \n                            const piece = boardState.find(p => p.x === 7 && p.y === 7)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                    }\n                this.endMove(px, py, x, y, team, boardState, oldBoardState, valid, false)\n                }\n            break;\n            }\n        }\n    console.log(valid.value)\n    return valid.value\n    }\n}"]},"metadata":{},"sourceType":"module"}