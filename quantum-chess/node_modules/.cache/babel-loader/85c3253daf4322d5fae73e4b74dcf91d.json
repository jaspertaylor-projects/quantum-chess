{"ast":null,"code":"var _jsxFileName = \"/home/jaybird/Coding Projects/Chess4/chess/src/components/chessboard/chessboard.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useState } from 'react';\nimport Tile from '../Tile/Tile';\nimport './chessboard.css';\nimport Referee from '../../referee/Referee';\nimport { VERTICAL_AXIS, HORIZONTAL_AXIS, GRID_SIZE, TeamType, initialBoardState } from '../../constants';\nimport Checker from '../../referee/boardChecks';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chessboard() {\n  _s();\n\n  const [activePiece, setActivePiece] = useState(null);\n  const [gridX, setGridX] = useState(0);\n  const [gridY, setGridY] = useState(0);\n  const [pieces, setPieces] = useState(initialBoardState);\n  const [activePlayer, setActivePlayer] = useState(TeamType.WHITE);\n  const [promote, setPromote] = useState({\n    isPromoted: false,\n    x: -10,\n    y: -10\n  });\n  const chessboardRef = useRef(null);\n  const referee = new Referee();\n  const checker = new Checker();\n  let board = [];\n\n  function switchPlayer() {\n    const nextPlayer = activePlayer === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE;\n    setActivePlayer(nextPlayer);\n  }\n\n  function deepCopy() {\n    const oldBoardState = [];\n    pieces.forEach(p => oldBoardState.push({\n      image: p.image,\n      x: p.x,\n      y: p.y,\n      team: p.team,\n      type: p.type,\n      enPassantable: p.enPassantable,\n      canCastle: p.canCastle,\n      promoted: p.promoted\n    }));\n    return oldBoardState;\n  }\n\n  function revert() {\n    if (activePiece) {\n      activePiece.style.position = 'relative';\n      activePiece.style.removeProperty('left');\n      activePiece.style.removeProperty('top');\n    }\n  }\n\n  function takePiece(p) {\n    const id2 = pieces.indexOf(p);\n    pieces.splice(id2, 1);\n  }\n\n  function teleportPiece(p) {\n    let tele = 0;\n\n    if (p.x === 7) {\n      tele = -2;\n    } else {\n      tele = 3;\n    }\n\n    p.x = p.x + tele;\n    p.teleported = false;\n  }\n\n  function grabPiece(e) {\n    const chessboard = chessboardRef.current;\n    const element = e.target;\n\n    if (element.classList.contains('chess-piece') && chessboard) {\n      setGridX(Math.floor((e.clientX - chessboard.offsetLeft) / GRID_SIZE));\n      setGridY(Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE) / GRID_SIZE)));\n      const x = e.clientX - GRID_SIZE / 2;\n      const y = e.clientY - GRID_SIZE / 2;\n      element.style.position = 'absolute';\n      element.style.left = `${x}px`;\n      element.style.top = `${y}px`;\n      setActivePiece(element);\n    }\n  }\n\n  function movePiece(e) {\n    const chessboard = chessboardRef.current;\n\n    if (activePiece && chessboard) {\n      const x = e.clientX - GRID_SIZE / 2;\n      const y = e.clientY - GRID_SIZE / 2;\n      activePiece.style.position = 'absolute';\n      activePiece.style.left = `${x}px`;\n      activePiece.style.top = `${y}px`;\n    }\n  }\n\n  function dropPiece(e) {\n    const chessboard = chessboardRef.current;\n\n    if (activePiece && chessboard) {\n      const x = Math.floor((e.clientX - chessboard.offsetLeft) / GRID_SIZE);\n      const y = Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE) / GRID_SIZE));\n      const currentPiece = pieces.find(p => p.x === gridX && p.y === gridY);\n\n      if (currentPiece) {\n        const oldBoardState = deepCopy();\n        const validMove = referee.isValidMove(gridX, gridY, x, y, currentPiece.type, currentPiece.team, pieces, activePlayer);\n\n        if (validMove) {\n          const takenPiece = pieces.find(p => p.taken === true);\n\n          if (takenPiece) {\n            takePiece(takenPiece);\n          }\n\n          const teleportedPiece = pieces.find(p => p.teleported === true);\n\n          if (teleportedPiece) {\n            teleportPiece(teleportedPiece);\n          }\n\n          const promotedPiece = pieces.find(p => p.promoted === true);\n\n          if (promotedPiece) {\n            setPromote({\n              isPromoted: true,\n              x: x,\n              y: y\n            });\n          }\n\n          const id1 = pieces.indexOf(currentPiece);\n          currentPiece.x = x;\n          currentPiece.y = y;\n          pieces[id1] = currentPiece;\n\n          if (checker.isMyKingInCheck(currentPiece.team, pieces, 0)) {\n            setPieces(oldBoardState);\n            revert();\n          } else {\n            setPieces(pieces);\n            switchPlayer();\n          }\n        } else {\n          revert();\n        }\n      }\n    }\n\n    setActivePiece(null);\n  }\n\n  for (let j = VERTICAL_AXIS.length - 1; j >= 0; j--) {\n    for (let i = 0; i < HORIZONTAL_AXIS.length; i++) {\n      const number = i + j;\n      const piece = pieces.find(p => p.x === i && p.y === j);\n      let image = piece ? piece.image : undefined;\n\n      if (promote.x === i && promote.y === j) {\n        board.push( /*#__PURE__*/_jsxDEV(Tile, {\n          image: image,\n          number: number,\n          isPromotion: true\n        }, `${i}, ${j}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 28\n        }, this));\n      } else {\n        board.push( /*#__PURE__*/_jsxDEV(Tile, {\n          image: image,\n          number: number,\n          isPromotion: false\n        }, `${i}, ${j}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 28\n        }, this));\n      }\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: chessboardRef,\n    onMouseUp: e => dropPiece(e),\n    onMouseMove: e => movePiece(e),\n    onMouseDown: e => grabPiece(e),\n    id: \"chessboard\",\n    children: [board, /*#__PURE__*/_jsxDEV(Tile, {\n      number: 15,\n      isPromotion: false\n    }, 'gdsa', false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 12\n  }, this);\n}\n\n_s(Chessboard, \"BmxxPY8frSDGetRlFktDQNH7gTg=\");\n\n_c = Chessboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chessboard\");","map":{"version":3,"sources":["/home/jaybird/Coding Projects/Chess4/chess/src/components/chessboard/chessboard.tsx"],"names":["React","useRef","useState","Tile","Referee","VERTICAL_AXIS","HORIZONTAL_AXIS","GRID_SIZE","TeamType","initialBoardState","Checker","Chessboard","activePiece","setActivePiece","gridX","setGridX","gridY","setGridY","pieces","setPieces","activePlayer","setActivePlayer","WHITE","promote","setPromote","isPromoted","x","y","chessboardRef","referee","checker","board","switchPlayer","nextPlayer","BLACK","deepCopy","oldBoardState","forEach","p","push","image","team","type","enPassantable","canCastle","promoted","revert","style","position","removeProperty","takePiece","id2","indexOf","splice","teleportPiece","tele","teleported","grabPiece","e","chessboard","current","element","target","classList","contains","Math","floor","clientX","offsetLeft","abs","ceil","clientY","offsetTop","left","top","movePiece","dropPiece","currentPiece","find","validMove","isValidMove","takenPiece","taken","teleportedPiece","promotedPiece","id1","isMyKingInCheck","j","length","i","number","piece","undefined"],"mappings":"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","sourcesContent":["import React, {useRef, useState, } from 'react';\nimport Tile from '../Tile/Tile';\nimport PopUp from '../PopUp/PopUp';\nimport './chessboard.css';\nimport Referee from '../../referee/Referee'\nimport {VERTICAL_AXIS, HORIZONTAL_AXIS, GRID_SIZE, Piece, TeamType, initialBoardState, PromotionSquare} from '../../constants'\nimport Checker from '../../referee/boardChecks'\n\nexport default function Chessboard(){\n    const [activePiece, setActivePiece] = useState<HTMLElement | null>(null) \n    const [gridX, setGridX] = useState(0);\n    const [gridY, setGridY] = useState(0);\n    const [pieces, setPieces]  = useState<Piece[]>(initialBoardState);\n    const [activePlayer, setActivePlayer] = useState<TeamType>(TeamType.WHITE);\n    const [promote, setPromote] = useState<PromotionSquare>({isPromoted : false, x : -10, y : -10})\n    const chessboardRef = useRef<HTMLDivElement>(null);\n    const referee = new Referee();\n    const checker = new Checker();\n    let board = [];\n\n\n    function switchPlayer(){\n        const nextPlayer = activePlayer === TeamType.WHITE ? TeamType.BLACK : TeamType.WHITE\n        setActivePlayer(nextPlayer) \n    }\n\n    function deepCopy() : Piece [] {\n        const oldBoardState : Piece[] = [];\n        pieces.forEach(p => oldBoardState.push({image : p.image, x : p.x,  y : p.y,\n                                                team : p.team, type : p.type, \n                                                enPassantable : p.enPassantable,\n                                                canCastle: p.canCastle,\n                                                promoted: p.promoted}))\n        return oldBoardState\n    }\n\n    function revert(){\n        if (activePiece){\n            activePiece.style.position = 'relative';\n            activePiece.style.removeProperty('left');\n            activePiece.style.removeProperty('top');\n        }\n    }\n\n    function takePiece(p : Piece){\n        const id2 = pieces.indexOf(p)\n        pieces.splice(id2, 1)\n    }\n\n    function teleportPiece(p : Piece){\n        let tele = 0;\n        if (p.x === 7){  \n            tele = -2\n        } else {\n            tele = 3\n        }\n        p.x = p.x + tele\n        p.teleported = false\n    }\n\n    function grabPiece(e: React.MouseEvent){\n        const chessboard = chessboardRef.current\n        const element = e.target as HTMLElement\n        if (element.classList.contains('chess-piece') && chessboard){\n            setGridX(Math.floor((e.clientX - chessboard.offsetLeft)/GRID_SIZE));\n            setGridY(Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE)/GRID_SIZE)));\n            const x = e.clientX - GRID_SIZE/2;\n            const y = e.clientY - GRID_SIZE/2;\n            element.style.position = 'absolute'; \n            element.style.left = `${x}px`;\n            element.style.top = `${y}px`;\n            setActivePiece(element)    \n        }\n    \n    }\n    \n    function movePiece(e: React.MouseEvent){\n        const chessboard = chessboardRef.current\n        if (activePiece && chessboard){\n            const x = e.clientX - GRID_SIZE/2;\n            const y = e.clientY - GRID_SIZE/2;\n            activePiece.style.position = 'absolute'; \n            activePiece.style.left = `${x}px`;\n            activePiece.style.top = `${y}px`;\n        }\n    }\n    \n    function dropPiece(e: React.MouseEvent){\n        const chessboard = chessboardRef.current;\n        if (activePiece && chessboard){\n            const x = Math.floor((e.clientX - chessboard.offsetLeft)/GRID_SIZE);\n            const y = Math.abs(Math.ceil((e.clientY - chessboard.offsetTop - 8 * GRID_SIZE)/GRID_SIZE))\n            const currentPiece = pieces.find(p => p.x === gridX && p.y === gridY)\n            if (currentPiece){\n                const oldBoardState = deepCopy()\n                const validMove = referee.isValidMove(gridX, gridY, x, y, currentPiece.type, currentPiece.team, pieces, activePlayer);                \n                if (validMove){  \n                    const takenPiece = pieces.find(p => p.taken === true)\n                    if (takenPiece){\n                        takePiece(takenPiece)\n                    }\n                    const teleportedPiece = pieces.find(p => p.teleported === true)\n                    if (teleportedPiece){\n                        teleportPiece(teleportedPiece)\n                    }\n                    const promotedPiece = pieces.find(p => p.promoted === true)\n                    if (promotedPiece){\n                        setPromote({isPromoted : true, x : x, y : y})\n                    }\n                    const id1 = pieces.indexOf(currentPiece)\n                    currentPiece.x = x\n                    currentPiece.y = y\n                    pieces[id1] = currentPiece\n                    if (checker.isMyKingInCheck(currentPiece.team, pieces, 0)){\n                        setPieces(oldBoardState)\n                        revert()\n                    } else {\n                        setPieces(pieces)\n                        switchPlayer()\n                    }\n                } else {\n                revert()\n                }\n            }\n        }\n        setActivePiece(null);\n    }\n\n    for (let j = VERTICAL_AXIS.length - 1; j >= 0; j-- ){\n        for (let i = 0; i < HORIZONTAL_AXIS.length; i++ ) {\n            const number = i + j;\n            const piece = pieces.find(p => p.x === i && p.y === j) \n            let image = piece ? piece.image : undefined\n            if (promote.x === i && promote.y === j){\n                board.push(<Tile key = {`${i}, ${j}`} image = {image} number = {number} isPromotion = {true}/>);\n            } else {\n                board.push(<Tile key = {`${i}, ${j}`} image = {image} number = {number} isPromotion = {false}/>);\n            }\n        }\n    }\n    return <div \n    ref = {chessboardRef} \n    onMouseUp = {e => dropPiece(e)} \n    onMouseMove = {e => movePiece(e)} \n    onMouseDown = {e => grabPiece(e)} \n    id = 'chessboard'>{board}\n    <Tile key = {'gdsa'} number = {15} isPromotion = {false}/>\n    </div>;\n}"]},"metadata":{},"sourceType":"module"}