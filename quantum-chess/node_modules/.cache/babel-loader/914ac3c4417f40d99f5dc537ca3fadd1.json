{"ast":null,"code":"import { PieceType, TeamType, AXIS } from \"../constants\";\nimport { isPawnNormalMove, isEnPassant, isPawnStartingMove, isFriendlyPiece, unsetEnPassant, setEnPassant } from \"./pawnLogic\";\nimport { isLegalBishopMove, isLegalRookMove, isLegalQueenMove, isLegalKingMove, isLegalNightMove, isCastleMove } from \"./pieceLogic\";\nimport { CLICKED } from '../components/PopUp/PopUp';\nexport default class Referee {\n  promote(px, py, x, y, boardState) {\n    const piece = boardState.find(p => p.x === px && p.y === py);\n\n    if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.WHITE && y === 7) {\n      piece.promoted = true;\n    } else if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.BLACK && y === 0) {\n      piece.promoted = true;\n    } else if (piece) {\n      piece.promoted = false;\n    }\n  }\n\n  noCastle(px, py, boardState) {\n    const piece = boardState.find(p => p.x === px && p.y === py);\n\n    if (piece) {\n      piece.canCastle = false;\n    }\n  }\n\n  takePiece(x, y, team, boardState) {\n    const piece = boardState.find(p => p.x === x && p.y === y && p.team !== team);\n\n    if (piece) {\n      piece.taken = true;\n    }\n  }\n\n  endMove(px, py, x, y, team, boardState, valid) {\n    if (!isFriendlyPiece(x, y, team, boardState)) {\n      this.promote(px, py, x, y, boardState);\n      this.noCastle(px, py, boardState);\n      this.takePiece(x, y, team, boardState);\n      unsetEnPassant(boardState);\n      valid.value = true;\n    }\n  }\n\n  isValidMove(px, py, x, y, type, team, boardState, activePlayer) {\n    if (CLICKED) {\n      return false;\n    } // Only the active player can move\n\n\n    if (team !== activePlayer) {\n      return false;\n    } // A non-move is not a move\n\n\n    if (px === x && py === y) {\n      return false;\n    } // A move off the board is not a move\n\n\n    if (!(AXIS.includes(px) && AXIS.includes(py) && AXIS.includes(x) && AXIS.includes(y))) {\n      return false;\n    }\n\n    var valid = {\n      value: false\n    };\n    const dx = x - px;\n    const dy = y - py;\n\n    switch (type) {\n      case PieceType.PAWN:\n        {\n          if (isPawnStartingMove(px, py, x, y, team, boardState)) {\n            setEnPassant(px, py, boardState);\n            return true;\n          }\n\n          if (isPawnNormalMove(px, py, x, y, team, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, valid);\n          }\n\n          if (isEnPassant(px, py, x, y, team, boardState)) {\n            this.endMove(-1, -1, x, py, team, boardState, valid);\n          }\n\n          break;\n        }\n\n      case PieceType.NIGHT:\n        {\n          if (isLegalNightMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, valid);\n          }\n\n          break;\n        }\n\n      case PieceType.BISHOP:\n        {\n          if (isLegalBishopMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, valid);\n          }\n\n          break;\n        }\n\n      case PieceType.ROOK:\n        {\n          if (isLegalRookMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, valid);\n          }\n\n          break;\n        }\n\n      case PieceType.QUEEN:\n        {\n          if (isLegalQueenMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, valid);\n          }\n\n          break;\n        }\n\n      case PieceType.KING:\n        {\n          if (isLegalKingMove(px, py, dx, dy, boardState)) {\n            this.endMove(px, py, x, y, team, boardState, valid);\n          }\n\n          if (isCastleMove(px, py, dx, dy, activePlayer, boardState)) {\n            if (activePlayer === TeamType.WHITE) {\n              if (dx === -2) {\n                const piece = boardState.find(p => p.x === 0 && p.y === 0);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n\n              if (dx === 2) {\n                const piece = boardState.find(p => p.x === 7 && p.y === 0);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n            }\n\n            if (activePlayer === TeamType.BLACK) {\n              if (dx === -2) {\n                const piece = boardState.find(p => p.x === 0 && p.y === 7);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n\n              if (dx === 2) {\n                const piece = boardState.find(p => p.x === 7 && p.y === 7);\n\n                if (piece) {\n                  piece.teleported = true;\n                }\n              }\n            }\n\n            this.endMove(px, py, x, y, team, boardState, valid);\n          }\n\n          break;\n        }\n    }\n\n    return valid.value;\n  }\n\n}","map":{"version":3,"sources":["/home/jaybird/Coding Projects/Chess4/chess/src/referee/Referee.ts"],"names":["PieceType","TeamType","AXIS","isPawnNormalMove","isEnPassant","isPawnStartingMove","isFriendlyPiece","unsetEnPassant","setEnPassant","isLegalBishopMove","isLegalRookMove","isLegalQueenMove","isLegalKingMove","isLegalNightMove","isCastleMove","CLICKED","Referee","promote","px","py","x","y","boardState","piece","find","p","type","PAWN","team","WHITE","promoted","BLACK","noCastle","canCastle","takePiece","taken","endMove","valid","value","isValidMove","activePlayer","includes","dx","dy","NIGHT","BISHOP","ROOK","QUEEN","KING","teleported"],"mappings":"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","sourcesContent":["\nimport { PieceType, TeamType, Piece, AXIS, } from \"../constants\"\nimport { isPawnNormalMove, isEnPassant, isPawnStartingMove, isFriendlyPiece, unsetEnPassant, setEnPassant } from \"./pawnLogic\"\nimport { isLegalBishopMove, isLegalRookMove, isLegalQueenMove, isLegalKingMove, isLegalNightMove, isCastleMove} from \"./pieceLogic\"\nimport {CLICKED} from '../components/PopUp/PopUp'\n\nexport default class Referee{\n    promote(px: number, py: number, x : number, y: number, boardState : Piece []){\n    const piece = boardState.find(p => p.x === px && p.y === py)\n        if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.WHITE && y === 7){\n            piece.promoted = true\n        }   \n        else if (piece && piece.type === PieceType.PAWN && piece.team === TeamType.BLACK && y === 0){\n            piece.promoted = true\n        } else if (piece){\n            piece.promoted = false\n        }\n    }    \n    noCastle(px: number, py: number, boardState : Piece []){\n        const piece = boardState.find(p => p.x === px && p.y === py)\n        if (piece){\n            piece.canCastle = false\n        }\n    }\n    takePiece(x : number, y: number, team : TeamType, boardState : Piece []){\n        const piece = boardState.find(p => p.x === x && p.y === y && p.team !== team)  \n                if (piece) {\n            piece.taken = true\n        }\n    }\n    endMove(px : number, py : number, x : number, y: number, team : TeamType, boardState : Piece [], \n            valid : any){\n        if (!isFriendlyPiece(x, y, team, boardState)){\n            this.promote(px, py, x, y, boardState)\n            this.noCastle(px, py, boardState)\n            this.takePiece(x, y, team, boardState)\n            unsetEnPassant(boardState)\n            valid.value = true          \n        }\n    }\n    isValidMove(px : number, py : number, x : number, y : number, type : PieceType, \n                team : TeamType, boardState : Piece [], activePlayer : TeamType) : boolean{\n        if (CLICKED){\n            return false\n        }  \n        // Only the active player can move\n        if (team !== activePlayer){\n            return false\n        }\n        // A non-move is not a move\n        if (px === x && py === y){\n            return false\n        }\n        // A move off the board is not a move\n        if (!(AXIS.includes(px) &&  AXIS.includes(py) &&  AXIS.includes(x) && AXIS.includes(y))){\n            return false\n        }\n        var valid = { value: false }\n        const dx = x - px\n        const dy = y - py\n\n        switch(type){\n            case PieceType.PAWN : {\n                if (isPawnStartingMove(px, py, x, y, team, boardState)){\n                    setEnPassant(px, py, boardState)\n                    return true\n                }\n                if (isPawnNormalMove(px, py, x, y, team, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, valid)\n                }\n                if (isEnPassant(px, py, x, y, team, boardState)){\n                    this.endMove(-1, -1, x, py, team, boardState, valid)\n                }\n                break;\n            }\n            case PieceType.NIGHT : {\n                if (isLegalNightMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, valid)\n                }\n                break;\n            }\n            case PieceType.BISHOP : {\n                if (isLegalBishopMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, valid)\n                }\n                break;\n            }\n            case PieceType.ROOK : {\n                if (isLegalRookMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, valid)\n                }\n                break;\n            }\n            case PieceType.QUEEN : {\n                if (isLegalQueenMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, valid)\n                }\n                break;\n            }\n            case PieceType.KING : {\n                if (isLegalKingMove(px, py, dx, dy, boardState)){\n                    this.endMove(px, py, x, y, team, boardState, valid)\n                }\n                if (isCastleMove(px, py, dx, dy, activePlayer, boardState)){\n                    if (activePlayer === TeamType.WHITE){\n                        if (dx === -2){ \n                            const piece = boardState.find(p => p.x === 0 && p.y === 0)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                        if (dx === 2){ \n                            const piece = boardState.find(p => p.x === 7 && p.y === 0)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                    }\n                    if (activePlayer === TeamType.BLACK){\n                        if (dx === -2){ \n                            const piece = boardState.find(p => p.x === 0 && p.y === 7)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                        if (dx === 2){ \n                            const piece = boardState.find(p => p.x === 7 && p.y === 7)\n                            if (piece){\n                                piece.teleported = true\n                            }\n                        }\n                    }\n                this.endMove(px, py, x, y, team, boardState, valid)\n                }\n            break;\n            }\n        }\n    return valid.value\n    }\n}"]},"metadata":{},"sourceType":"module"}